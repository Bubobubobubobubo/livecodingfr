let Y=[],D=0;const be=4;let Bt=e=>{let t=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(a){return n.lc=t.push(a),()=>{for(let l=D+be;l<Y.length;)Y[l]===a?Y.splice(l,be):l+=be;let c=t.indexOf(a);~c&&(t.splice(c,1),--n.lc||n.off())}},notify(a,c){let l=!Y.length;for(let s of t)Y.push(s,n.value,a,c);if(l){for(D=0;D<Y.length;D+=be)Y[D](Y[D+1],Y[D+2],Y[D+3]);Y.length=0}},off(){},set(a){let c=n.value;c!==a&&(n.value=a,n.notify(c))},subscribe(a){let c=n.listen(a);return a(n.value),c},value:e};return n},jt=(e={})=>{let t=Bt(e);return t.setKey=function(n,a){let c=t.value;typeof a>"u"&&n in t.value?(t.value={...t.value},delete t.value[n],t.notify(c,n)):t.value[n]!==a&&(t.value={...t.value,[n]:a},t.notify(c,n))},t};if(typeof DelayNode<"u"){class e extends DelayNode{constructor(n,a,c,l){super(n),a=Math.abs(a),this.delayTime.value=c;const s=n.createGain();s.gain.value=Math.min(Math.abs(l),.995),this.feedback=s.gain;const o=n.createGain();return o.gain.value=a,this.delayGain=o,this.connect(s),this.connect(o),s.connect(this),this.connect=d=>o.connect(d),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(t,n,a){return new e(this,t,n,a)}}var Ie={};Ie.generateReverb=function(e,t){for(var n=e.audioContext||new AudioContext,a=n.sampleRate,c=e.numChannels||2,l=e.decayTime*1.5,s=Math.round(e.decayTime*a),o=Math.round(l*a),d=Math.round((e.fadeInTime||0)*a),r=Math.pow(1/1e3,1/s),i=n.createBuffer(c,o,a),b=0;b<c;b++){for(var u=i.getChannelData(b),m=0;m<o;m++)u[m]=Et()*Math.pow(r,m);for(var m=0;m<d;m++)u[m]*=m/d}Ut(i,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,t)};Ie.generateGraph=function(e,t,n,a,c){var l=document.createElement("canvas");l.width=t,l.height=n;var s=l.getContext("2d");s.fillStyle="#000",s.fillRect(0,0,l.width,l.height),s.fillStyle="#fff";for(var o=t/e.length,d=n/(c-a),r=0;r<e.length;r++)s.fillRect(r*o,n-(e[r]-a)*d,1,1);return l};var Ut=function(e,t,n,a,c){if(t==0){c(e);return}var l=Ot(e),s=new OfflineAudioContext(e.numberOfChannels,l[0].length,e.sampleRate),o=s.createBufferSource();o.buffer=e;var d=s.createBiquadFilter();t=Math.min(t,e.sampleRate/2),n=Math.min(n,e.sampleRate/2),d.type="lowpass",d.Q.value=1e-4,d.frequency.setValueAtTime(t,0),d.frequency.linearRampToValueAtTime(n,a),o.connect(d),d.connect(s.destination),o.start(),s.oncomplete=function(r){c(r.renderedBuffer)},s.startRendering(),window.filterNode=d},Ot=function(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t},Et=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,t){const n=t.sampleRate*e,a=this.createBuffer(t.numberOfChannels,t.length,t.sampleRate);for(let c=0;c<t.numberOfChannels;c++){let l=t.getChannelData(c),s=a.getChannelData(c);for(let o=0;o<n;o++)s[o]=l[o]||0}return a},AudioContext.prototype.createReverb=function(e,t,n,a,c){const l=this.createConvolver();return l.generate=(s=2,o=.1,d=15e3,r=1e3,i)=>{l.duration=s,l.fade=o,l.lp=d,l.dim=r,l.ir=i,i?l.buffer=this.adjustLength(s,i):Ie.generateReverb({audioContext:this,numChannels:2,decayTime:s,fadeInTime:o,lpFreqStart:d,lpFreqEnd:r},b=>{l.buffer=b})},l.generate(e,t,n,a,c),l});var it={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get æ(){return this.ae},get ø(){return this.oe},get ɑ(){return this.aa},get å(){return this.aa},get ö(){return this.oe},get ü(){return this.ue},get ı(){return this.y}};if(typeof GainNode<"u"){class e extends GainNode{constructor(n,a){if(super(n),!it[a])throw new Error("vowel: unknown vowel "+a);const{gains:c,qs:l,freqs:s}=it[a],o=n.createGain();for(let d=0;d<5;d++){const r=n.createGain();r.gain.value=c[d];const i=n.createBiquadFilter();i.type="bandpass",i.Q.value=l[d],i.frequency.value=s[d],this.connect(i),i.connect(r),r.connect(o)}return o.gain.value=8,this.connect=d=>o.connect(d),this}}AudioContext.prototype.createVowelFilter=function(t){return new e(this,t)}}let pt=e=>console.log(e);const w=(...e)=>pt(...e),kn=e=>{pt=e},Dt=e=>{var c;if(typeof e!="string")return[];const[t,n="",a]=((c=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/))==null?void 0:c.slice(1))||[];return t?[t,n,a?Number(a):void 0]:[]},At={c:0,d:2,e:4,f:5,g:7,a:9,b:11},qt={"#":1,b:-1,s:1,f:-1},Ge=(e,t=3)=>{const[n,a,c=t]=Dt(e);if(!n)throw new Error('not a note: "'+e+'"');const l=At[n.toLowerCase()],s=(a==null?void 0:a.split("").reduce((o,d)=>o+qt[d],0))||0;return(Number(c)+1)*12+l+s},yt=e=>Math.pow(2,(e-69)/12)*440,se=(e,t,n)=>Math.min(Math.max(e,t),n),$t=e=>12*Math.log(e/440)/Math.LN2+69,_t=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:a}=e;return typeof n=="number"?$t(n):typeof a=="string"?Ge(a):typeof a=="number"?a:t};function j(e,t=0,n){return isNaN(Number(e))?(!n&&w(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const ht=(e,t)=>(e%t+t)%t,ut=(e,t)=>ht(Math.round(j(e,0)),t),en="data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIHZ0IGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye2NvbnN0cnVjdG9yKHQpe3N1cGVyKHQpLHRoaXMuc3RhcnRlZD0hMSx0aGlzLm5iSW5wdXRzPXQubnVtYmVyT2ZJbnB1dHMsdGhpcy5uYk91dHB1dHM9dC5udW1iZXJPZk91dHB1dHMsdGhpcy5ibG9ja1NpemU9dC5wcm9jZXNzb3JPcHRpb25zLmJsb2NrU2l6ZSx0aGlzLmhvcFNpemU9MTI4LHRoaXMubmJPdmVybGFwcz10aGlzLmJsb2NrU2l6ZS90aGlzLmhvcFNpemUsdGhpcy5pbnB1dEJ1ZmZlcnM9bmV3IEFycmF5KHRoaXMubmJJbnB1dHMpLHRoaXMuaW5wdXRCdWZmZXJzSGVhZD1uZXcgQXJyYXkodGhpcy5uYklucHV0cyksdGhpcy5pbnB1dEJ1ZmZlcnNUb1NlbmQ9bmV3IEFycmF5KHRoaXMubmJJbnB1dHMpO2ZvcihsZXQgZT0wO2U8dGhpcy5uYklucHV0cztlKyspdGhpcy5hbGxvY2F0ZUlucHV0Q2hhbm5lbHMoZSwxKTt0aGlzLm91dHB1dEJ1ZmZlcnM9bmV3IEFycmF5KHRoaXMubmJPdXRwdXRzKSx0aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlPW5ldyBBcnJheSh0aGlzLm5iT3V0cHV0cyk7Zm9yKGxldCBlPTA7ZTx0aGlzLm5iT3V0cHV0cztlKyspdGhpcy5hbGxvY2F0ZU91dHB1dENoYW5uZWxzKGUsMSl9cmVhbGxvY2F0ZUNoYW5uZWxzSWZOZWVkZWQodCxlKXtmb3IobGV0IHM9MDtzPHRoaXMubmJJbnB1dHM7cysrKXtsZXQgcj10W3NdLmxlbmd0aDtyIT10aGlzLmlucHV0QnVmZmVyc1tzXS5sZW5ndGgmJnRoaXMuYWxsb2NhdGVJbnB1dENoYW5uZWxzKHMscil9Zm9yKGxldCBzPTA7czx0aGlzLm5iT3V0cHV0cztzKyspe2xldCByPWVbc10ubGVuZ3RoO3IhPXRoaXMub3V0cHV0QnVmZmVyc1tzXS5sZW5ndGgmJnRoaXMuYWxsb2NhdGVPdXRwdXRDaGFubmVscyhzLHIpfX1hbGxvY2F0ZUlucHV0Q2hhbm5lbHModCxlKXt0aGlzLmlucHV0QnVmZmVyc1t0XT1uZXcgQXJyYXkoZSk7Zm9yKGxldCBzPTA7czxlO3MrKyl0aGlzLmlucHV0QnVmZmVyc1t0XVtzXT1uZXcgRmxvYXQzMkFycmF5KHRoaXMuYmxvY2tTaXplKzEyOCksdGhpcy5pbnB1dEJ1ZmZlcnNbdF1bc10uZmlsbCgwKTt0aGlzLmlucHV0QnVmZmVyc0hlYWRbdF09bmV3IEFycmF5KGUpLHRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kW3RdPW5ldyBBcnJheShlKTtmb3IobGV0IHM9MDtzPGU7cysrKXRoaXMuaW5wdXRCdWZmZXJzSGVhZFt0XVtzXT10aGlzLmlucHV0QnVmZmVyc1t0XVtzXS5zdWJhcnJheSgwLHRoaXMuYmxvY2tTaXplKSx0aGlzLmlucHV0QnVmZmVyc1RvU2VuZFt0XVtzXT1uZXcgRmxvYXQzMkFycmF5KHRoaXMuYmxvY2tTaXplKX1hbGxvY2F0ZU91dHB1dENoYW5uZWxzKHQsZSl7dGhpcy5vdXRwdXRCdWZmZXJzW3RdPW5ldyBBcnJheShlKTtmb3IobGV0IHM9MDtzPGU7cysrKXRoaXMub3V0cHV0QnVmZmVyc1t0XVtzXT1uZXcgRmxvYXQzMkFycmF5KHRoaXMuYmxvY2tTaXplKSx0aGlzLm91dHB1dEJ1ZmZlcnNbdF1bc10uZmlsbCgwKTt0aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlW3RdPW5ldyBBcnJheShlKTtmb3IobGV0IHM9MDtzPGU7cysrKXRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmVbdF1bc109bmV3IEZsb2F0MzJBcnJheSh0aGlzLmJsb2NrU2l6ZSksdGhpcy5vdXRwdXRCdWZmZXJzVG9SZXRyaWV2ZVt0XVtzXS5maWxsKDApfXJlYWRJbnB1dHModCl7aWYodFswXS5sZW5ndGgmJnRbMF1bMF0ubGVuZ3RoPT0wKXtmb3IobGV0IGU9MDtlPHRoaXMubmJJbnB1dHM7ZSsrKWZvcihsZXQgcz0wO3M8dGhpcy5pbnB1dEJ1ZmZlcnNbZV0ubGVuZ3RoO3MrKyl0aGlzLmlucHV0QnVmZmVyc1tlXVtzXS5maWxsKDAsdGhpcy5ibG9ja1NpemUpO3JldHVybn1mb3IobGV0IGU9MDtlPHRoaXMubmJJbnB1dHM7ZSsrKWZvcihsZXQgcz0wO3M8dGhpcy5pbnB1dEJ1ZmZlcnNbZV0ubGVuZ3RoO3MrKyl7bGV0IHI9dFtlXVtzXTt0aGlzLmlucHV0QnVmZmVyc1tlXVtzXS5zZXQocix0aGlzLmJsb2NrU2l6ZSl9fXdyaXRlT3V0cHV0cyh0KXtmb3IobGV0IGU9MDtlPHRoaXMubmJJbnB1dHM7ZSsrKWZvcihsZXQgcz0wO3M8dGhpcy5pbnB1dEJ1ZmZlcnNbZV0ubGVuZ3RoO3MrKyl7bGV0IHI9dGhpcy5vdXRwdXRCdWZmZXJzW2VdW3NdLnN1YmFycmF5KDAsMTI4KTt0W2VdW3NdLnNldChyKX19c2hpZnRJbnB1dEJ1ZmZlcnMoKXtmb3IobGV0IHQ9MDt0PHRoaXMubmJJbnB1dHM7dCsrKWZvcihsZXQgZT0wO2U8dGhpcy5pbnB1dEJ1ZmZlcnNbdF0ubGVuZ3RoO2UrKyl0aGlzLmlucHV0QnVmZmVyc1t0XVtlXS5jb3B5V2l0aGluKDAsMTI4KX1zaGlmdE91dHB1dEJ1ZmZlcnMoKXtmb3IobGV0IHQ9MDt0PHRoaXMubmJPdXRwdXRzO3QrKylmb3IobGV0IGU9MDtlPHRoaXMub3V0cHV0QnVmZmVyc1t0XS5sZW5ndGg7ZSsrKXRoaXMub3V0cHV0QnVmZmVyc1t0XVtlXS5jb3B5V2l0aGluKDAsMTI4KSx0aGlzLm91dHB1dEJ1ZmZlcnNbdF1bZV0uc3ViYXJyYXkodGhpcy5ibG9ja1NpemUtMTI4KS5maWxsKDApfXByZXBhcmVJbnB1dEJ1ZmZlcnNUb1NlbmQoKXtmb3IobGV0IHQ9MDt0PHRoaXMubmJJbnB1dHM7dCsrKWZvcihsZXQgZT0wO2U8dGhpcy5pbnB1dEJ1ZmZlcnNbdF0ubGVuZ3RoO2UrKyl0aGlzLmlucHV0QnVmZmVyc1RvU2VuZFt0XVtlXS5zZXQodGhpcy5pbnB1dEJ1ZmZlcnNIZWFkW3RdW2VdKX1oYW5kbGVPdXRwdXRCdWZmZXJzVG9SZXRyaWV2ZSgpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYk91dHB1dHM7dCsrKWZvcihsZXQgZT0wO2U8dGhpcy5vdXRwdXRCdWZmZXJzW3RdLmxlbmd0aDtlKyspZm9yKGxldCBzPTA7czx0aGlzLmJsb2NrU2l6ZTtzKyspdGhpcy5vdXRwdXRCdWZmZXJzW3RdW2VdW3NdKz10aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlW3RdW2VdW3NdL3RoaXMubmJPdmVybGFwc31wcm9jZXNzKHQsZSxzKXtjb25zdCBuPXRbMF1bMF0hPT12b2lkIDA7cmV0dXJuIHRoaXMuc3RhcnRlZCYmIW4/ITE6KHRoaXMuc3RhcnRlZD1uLHRoaXMucmVhbGxvY2F0ZUNoYW5uZWxzSWZOZWVkZWQodCxlKSx0aGlzLnJlYWRJbnB1dHModCksdGhpcy5zaGlmdElucHV0QnVmZmVycygpLHRoaXMucHJlcGFyZUlucHV0QnVmZmVyc1RvU2VuZCgpLHRoaXMucHJvY2Vzc09MQSh0aGlzLmlucHV0QnVmZmVyc1RvU2VuZCx0aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlLHMpLHRoaXMuaGFuZGxlT3V0cHV0QnVmZmVyc1RvUmV0cmlldmUoKSx0aGlzLndyaXRlT3V0cHV0cyhlKSx0aGlzLnNoaWZ0T3V0cHV0QnVmZmVycygpLCEwKX1wcm9jZXNzT0xBKHQsZSxzKXtjb25zb2xlLmFzc2VydCghMSwiTm90IG92ZXJyaWRlbiIpfX1jbGFzcyBndHtjb25zdHJ1Y3Rvcih0KXtpZih0aGlzLnNpemU9dHwwLHRoaXMuc2l6ZTw9MXx8dGhpcy5zaXplJnRoaXMuc2l6ZS0xKXRocm93IG5ldyBFcnJvcigiRkZUIHNpemUgbXVzdCBiZSBhIHBvd2VyIG9mIHR3byBhbmQgYmlnZ2VyIHRoYW4gMSIpO3RoaXMuX2NzaXplPXQ8PDE7Zm9yKHZhciBlPW5ldyBBcnJheSh0aGlzLnNpemUqMikscz0wO3M8ZS5sZW5ndGg7cys9Mil7Y29uc3QgYT1NYXRoLlBJKnMvdGhpcy5zaXplO2Vbc109TWF0aC5jb3MoYSksZVtzKzFdPS1NYXRoLnNpbihhKX10aGlzLnRhYmxlPWU7Zm9yKHZhciByPTAsbj0xO3RoaXMuc2l6ZT5uO248PD0xKXIrKzt0aGlzLl93aWR0aD1yJTI9PT0wP3ItMTpyLHRoaXMuX2JpdHJldj1uZXcgQXJyYXkoMTw8dGhpcy5fd2lkdGgpO2Zvcih2YXIgaT0wO2k8dGhpcy5fYml0cmV2Lmxlbmd0aDtpKyspe3RoaXMuX2JpdHJldltpXT0wO2Zvcih2YXIgaD0wO2g8dGhpcy5fd2lkdGg7aCs9Mil7dmFyIGM9dGhpcy5fd2lkdGgtaC0yO3RoaXMuX2JpdHJldltpXXw9KGk+Pj5oJjMpPDxjfX10aGlzLl9vdXQ9bnVsbCx0aGlzLl9kYXRhPW51bGwsdGhpcy5faW52PTB9ZnJvbUNvbXBsZXhBcnJheSh0LGUpe2Zvcih2YXIgcz1lfHxuZXcgQXJyYXkodC5sZW5ndGg+Pj4xKSxyPTA7cjx0Lmxlbmd0aDtyKz0yKXNbcj4+PjFdPXRbcl07cmV0dXJuIHN9Y3JlYXRlQ29tcGxleEFycmF5KCl7Y29uc3QgdD1uZXcgQXJyYXkodGhpcy5fY3NpemUpO2Zvcih2YXIgZT0wO2U8dC5sZW5ndGg7ZSsrKXRbZV09MDtyZXR1cm4gdH10b0NvbXBsZXhBcnJheSh0LGUpe2Zvcih2YXIgcz1lfHx0aGlzLmNyZWF0ZUNvbXBsZXhBcnJheSgpLHI9MDtyPHMubGVuZ3RoO3IrPTIpc1tyXT10W3I+Pj4xXSxzW3IrMV09MDtyZXR1cm4gc31jb21wbGV0ZVNwZWN0cnVtKHQpe2Zvcih2YXIgZT10aGlzLl9jc2l6ZSxzPWU+Pj4xLHI9MjtyPHM7cis9Mil0W2Utcl09dFtyXSx0W2UtcisxXT0tdFtyKzFdfXRyYW5zZm9ybSh0LGUpe2lmKHQ9PT1lKXRocm93IG5ldyBFcnJvcigiSW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIG11c3QgYmUgZGlmZmVyZW50Iik7dGhpcy5fb3V0PXQsdGhpcy5fZGF0YT1lLHRoaXMuX2ludj0wLHRoaXMuX3RyYW5zZm9ybTQoKSx0aGlzLl9vdXQ9bnVsbCx0aGlzLl9kYXRhPW51bGx9cmVhbFRyYW5zZm9ybSh0LGUpe2lmKHQ9PT1lKXRocm93IG5ldyBFcnJvcigiSW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIG11c3QgYmUgZGlmZmVyZW50Iik7dGhpcy5fb3V0PXQsdGhpcy5fZGF0YT1lLHRoaXMuX2ludj0wLHRoaXMuX3JlYWxUcmFuc2Zvcm00KCksdGhpcy5fb3V0PW51bGwsdGhpcy5fZGF0YT1udWxsfWludmVyc2VUcmFuc2Zvcm0odCxlKXtpZih0PT09ZSl0aHJvdyBuZXcgRXJyb3IoIklucHV0IGFuZCBvdXRwdXQgYnVmZmVycyBtdXN0IGJlIGRpZmZlcmVudCIpO3RoaXMuX291dD10LHRoaXMuX2RhdGE9ZSx0aGlzLl9pbnY9MSx0aGlzLl90cmFuc2Zvcm00KCk7Zm9yKHZhciBzPTA7czx0Lmxlbmd0aDtzKyspdFtzXS89dGhpcy5zaXplO3RoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbH1fdHJhbnNmb3JtNCgpe3ZhciB0PXRoaXMuX291dCxlPXRoaXMuX2NzaXplLHM9dGhpcy5fd2lkdGgscj0xPDxzLG49ZS9yPDwxLGksaCxjPXRoaXMuX2JpdHJldjtpZihuPT09NClmb3IoaT0wLGg9MDtpPGU7aSs9bixoKyspe2NvbnN0IG09Y1toXTt0aGlzLl9zaW5nbGVUcmFuc2Zvcm0yKGksbSxyKX1lbHNlIGZvcihpPTAsaD0wO2k8ZTtpKz1uLGgrKyl7Y29uc3QgbT1jW2hdO3RoaXMuX3NpbmdsZVRyYW5zZm9ybTQoaSxtLHIpfXZhciBhPXRoaXMuX2ludj8tMToxLHU9dGhpcy50YWJsZTtmb3Iocj4+PTI7cj49MjtyPj49Mil7bj1lL3I8PDE7dmFyIGY9bj4+PjI7Zm9yKGk9MDtpPGU7aSs9bilmb3IodmFyIHA9aStmLGw9aSxkPTA7bDxwO2wrPTIsZCs9cil7Y29uc3QgbT1sLGc9bStmLHY9ZytmLEk9ditmLF89dFttXSx3PXRbbSsxXSxiPXRbZ10sQj10W2crMV0sVD10W3ZdLFA9dFt2KzFdLHk9dFtJXSxBPXRbSSsxXSx4PV8sRj13LFY9dVtkXSxNPWEqdVtkKzFdLE89YipWLUIqTSxOPWIqTStCKlYsWT11WzIqZF0sTD1hKnVbMipkKzFdLEg9VCpZLVAqTCxVPVQqTCtQKlksSz11WzMqZF0sWj1hKnVbMypkKzFdLCQ9eSpLLUEqWixHPXkqWitBKkssaj14K0gsQz1GK1Usaz14LUgsSj1GLVUsUT1PKyQsej1OK0csRT1hKihPLSQpLFg9YSooTi1HKSxldD1qK1EsaXQ9Qyt6LG90PWotUSxhdD1DLXosaHQ9aytYLHV0PUotRSxjdD1rLVgsbHQ9SitFO3RbbV09ZXQsdFttKzFdPWl0LHRbZ109aHQsdFtnKzFdPXV0LHRbdl09b3QsdFt2KzFdPWF0LHRbSV09Y3QsdFtJKzFdPWx0fX19X3NpbmdsZVRyYW5zZm9ybTIodCxlLHMpe2NvbnN0IHI9dGhpcy5fb3V0LG49dGhpcy5fZGF0YSxpPW5bZV0saD1uW2UrMV0sYz1uW2Urc10sYT1uW2UrcysxXSx1PWkrYyxmPWgrYSxwPWktYyxsPWgtYTtyW3RdPXUsclt0KzFdPWYsclt0KzJdPXAsclt0KzNdPWx9X3NpbmdsZVRyYW5zZm9ybTQodCxlLHMpe2NvbnN0IHI9dGhpcy5fb3V0LG49dGhpcy5fZGF0YSxpPXRoaXMuX2ludj8tMToxLGg9cyoyLGM9cyozLGE9bltlXSx1PW5bZSsxXSxmPW5bZStzXSxwPW5bZStzKzFdLGw9bltlK2hdLGQ9bltlK2grMV0sbT1uW2UrY10sZz1uW2UrYysxXSx2PWErbCxJPXUrZCxfPWEtbCx3PXUtZCxiPWYrbSxCPXArZyxUPWkqKGYtbSksUD1pKihwLWcpLHk9ditiLEE9SStCLHg9XytQLEY9dy1ULFY9di1iLE09SS1CLE89Xy1QLE49dytUO3JbdF09eSxyW3QrMV09QSxyW3QrMl09eCxyW3QrM109RixyW3QrNF09VixyW3QrNV09TSxyW3QrNl09TyxyW3QrN109Tn1fcmVhbFRyYW5zZm9ybTQoKXt2YXIgdD10aGlzLl9vdXQsZT10aGlzLl9jc2l6ZSxzPXRoaXMuX3dpZHRoLHI9MTw8cyxuPWUvcjw8MSxpLGgsYz10aGlzLl9iaXRyZXY7aWYobj09PTQpZm9yKGk9MCxoPTA7aTxlO2krPW4saCsrKXtjb25zdCBmdD1jW2hdO3RoaXMuX3NpbmdsZVJlYWxUcmFuc2Zvcm0yKGksZnQ+Pj4xLHI+Pj4xKX1lbHNlIGZvcihpPTAsaD0wO2k8ZTtpKz1uLGgrKyl7Y29uc3QgZnQ9Y1toXTt0aGlzLl9zaW5nbGVSZWFsVHJhbnNmb3JtNChpLGZ0Pj4+MSxyPj4+MSl9dmFyIGE9dGhpcy5faW52Py0xOjEsdT10aGlzLnRhYmxlO2ZvcihyPj49MjtyPj0yO3I+Pj0yKXtuPWUvcjw8MTt2YXIgZj1uPj4+MSxwPWY+Pj4xLGw9cD4+PjE7Zm9yKGk9MDtpPGU7aSs9bilmb3IodmFyIGQ9MCxtPTA7ZDw9bDtkKz0yLG0rPXIpe3ZhciBnPWkrZCx2PWcrcCxJPXYrcCxfPUkrcCx3PXRbZ10sYj10W2crMV0sQj10W3ZdLFQ9dFt2KzFdLFA9dFtJXSx5PXRbSSsxXSxBPXRbX10seD10W18rMV0sRj13LFY9YixNPXVbbV0sTz1hKnVbbSsxXSxOPUIqTS1UKk8sWT1CKk8rVCpNLEw9dVsyKm1dLEg9YSp1WzIqbSsxXSxVPVAqTC15KkgsSz1QKkgreSpMLFo9dVszKm1dLCQ9YSp1WzMqbSsxXSxHPUEqWi14KiQsaj1BKiQreCpaLEM9RitVLGs9VitLLEo9Ri1VLFE9Vi1LLHo9TitHLEU9WStqLFg9YSooTi1HKSxldD1hKihZLWopLGl0PUMreixvdD1rK0UsYXQ9SitldCxodD1RLVg7aWYodFtnXT1pdCx0W2crMV09b3QsdFt2XT1hdCx0W3YrMV09aHQsZD09PTApe3ZhciB1dD1DLXosY3Q9ay1FO3RbSV09dXQsdFtJKzFdPWN0O2NvbnRpbnVlfWlmKGQhPT1sKXt2YXIgbHQ9Six6dD0tUSxFdD1DLFJ0PS1rLER0PS1hKmV0LHF0PS1hKlgsV3Q9LWEqRSxZdD0tYSp6LEx0PWx0K0R0LEh0PXp0K3F0LFV0PUV0K1l0LEt0PVJ0LVd0LGR0PWkrcC1kLG10PWkrZi1kO3RbZHRdPUx0LHRbZHQrMV09SHQsdFttdF09VXQsdFttdCsxXT1LdH19fX1fc2luZ2xlUmVhbFRyYW5zZm9ybTIodCxlLHMpe2NvbnN0IHI9dGhpcy5fb3V0LG49dGhpcy5fZGF0YSxpPW5bZV0saD1uW2Urc10sYz1pK2gsYT1pLWg7clt0XT1jLHJbdCsxXT0wLHJbdCsyXT1hLHJbdCszXT0wfV9zaW5nbGVSZWFsVHJhbnNmb3JtNCh0LGUscyl7Y29uc3Qgcj10aGlzLl9vdXQsbj10aGlzLl9kYXRhLGk9dGhpcy5faW52Py0xOjEsaD1zKjIsYz1zKjMsYT1uW2VdLHU9bltlK3NdLGY9bltlK2hdLHA9bltlK2NdLGw9YStmLGQ9YS1mLG09dStwLGc9aSoodS1wKSx2PWwrbSxJPWQsXz0tZyx3PWwtbSxiPWQsQj1nO3JbdF09dixyW3QrMV09MCxyW3QrMl09SSxyW3QrM109XyxyW3QrNF09dyxyW3QrNV09MCxyW3QrNl09YixyW3QrN109Qn19Y29uc3QgUj0obyx0LGUpPT5NYXRoLm1pbihNYXRoLm1heChvLHQpLGUpLEl0PShvLHQpPT4obyV0K3QpJXQsRD0xMjg7ZnVuY3Rpb24gYnQobyx0KXtyZXR1cm4gbzx0PyhvLz10LG8rby1vKm8tMSk6bz4xLXQ/KG89KG8tMSkvdCxvKm8rbytvKzEpOjB9Y29uc3Qgc3Q9e3RyaShvLHQ9LjUpe2NvbnN0IGU9MS10O3JldHVybiBvPj10PzEvZS1vL2U6by90fSxzaW5lKG8pe3JldHVybiBNYXRoLnNpbihNYXRoLlBJKjIqbykqLjUrLjV9LHJhbXAobyl7cmV0dXJuIG99LHNhdyhvKXtyZXR1cm4gMS1vfSxzcXVhcmUobyx0PS41KXtyZXR1cm4gbz49dD8wOjF9LGN1c3RvbShvLHQ9WzAsMV0pe2NvbnN0IGU9dC5sZW5ndGgtMSxzPU1hdGguZmxvb3IobyplKSxyPTEvZSxuPVIodFtzXSwwLDEpLGg9Uih0W3MrMV0sMCwxKSxjPW4sYT0wLHU9cjtyZXR1cm4oaC1jKS8odS1hKSooby1yKnMpK259LHNhd2JsZXAobyx0KXtyZXR1cm4gMipvLTEtYnQobyx0KX19O2Z1bmN0aW9uIHEobyx0KXtyZXR1cm4gdC5sZW5ndGg+MT90W29dOnRbMF19Y29uc3QgQnQ9T2JqZWN0LmtleXMoc3QpO2NsYXNzIF90IGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6InRpbWUiLGRlZmF1bHRWYWx1ZTowfSx7bmFtZToiZW5kIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImZyZXF1ZW5jeSIsZGVmYXVsdFZhbHVlOi41fSx7bmFtZToic2tldyIsZGVmYXVsdFZhbHVlOi41fSx7bmFtZToiZGVwdGgiLGRlZmF1bHRWYWx1ZToxfSx7bmFtZToicGhhc2VvZmZzZXQiLGRlZmF1bHRWYWx1ZTowfSx7bmFtZToic2hhcGUiLGRlZmF1bHRWYWx1ZTowfSx7bmFtZToiZGNvZmZzZXQiLGRlZmF1bHRWYWx1ZTowfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucGhhc2V9aW5jcmVtZW50UGhhc2UodCl7dGhpcy5waGFzZSs9dCx0aGlzLnBoYXNlPjEmJih0aGlzLnBoYXNlPXRoaXMucGhhc2UtMSl9cHJvY2Vzcyh0LGUscyl7aWYoY3VycmVudFRpbWU+PXMuZW5kWzBdKXJldHVybiExO2NvbnN0IHI9ZVswXSxuPXMuZnJlcXVlbmN5WzBdLGk9cy50aW1lWzBdLGg9cy5kZXB0aFswXSxjPXMuc2tld1swXSxhPXMucGhhc2VvZmZzZXRbMF0sdT1zLmRjb2Zmc2V0WzBdLGY9QnRbcy5zaGFwZVswXV0scD1yWzBdLmxlbmd0aD8/MDt0aGlzLnBoYXNlPT1udWxsJiYodGhpcy5waGFzZT1JdChpKm4rYSwxKSk7Y29uc3QgbD1uL3NhbXBsZVJhdGU7Zm9yKGxldCBkPTA7ZDxwO2QrKyl7Zm9yKGxldCBtPTA7bTxyLmxlbmd0aDttKyspe2NvbnN0IGc9KHN0W2ZdKHRoaXMucGhhc2UsYykrdSkqaDtyW21dW2RdPWd9dGhpcy5pbmNyZW1lbnRQaGFzZShsKX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImxmby1wcm9jZXNzb3IiLF90KTtjbGFzcyB3dCBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJjb2Fyc2UiLGRlZmF1bHRWYWx1ZToxfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuc3RhcnRlZD0hMX1wcm9jZXNzKHQsZSxzKXtjb25zdCByPXRbMF0sbj1lWzBdLGk9clswXSE9PXZvaWQgMDtpZih0aGlzLnN0YXJ0ZWQmJiFpKXJldHVybiExO3RoaXMuc3RhcnRlZD1pO2xldCBoPXMuY29hcnNlWzBdPz8wO2g9TWF0aC5tYXgoMSxoKTtmb3IobGV0IGM9MDtjPEQ7YysrKWZvcihsZXQgYT0wO2E8ci5sZW5ndGg7YSsrKW5bYV1bY109YyVoPT09MD9yW2FdW2NdOm5bYV1bYy0xXTtyZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImNvYXJzZS1wcm9jZXNzb3IiLHd0KTtjbGFzcyBTdCBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJjcnVzaCIsZGVmYXVsdFZhbHVlOjB9XX1jb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5zdGFydGVkPSExfXByb2Nlc3ModCxlLHMpe2NvbnN0IHI9dFswXSxuPWVbMF0saT1yWzBdIT09dm9pZCAwO2lmKHRoaXMuc3RhcnRlZCYmIWkpcmV0dXJuITE7dGhpcy5zdGFydGVkPWk7bGV0IGg9cy5jcnVzaFswXT8/ODtoPU1hdGgubWF4KDEsaCk7Zm9yKGxldCBjPTA7YzxEO2MrKylmb3IobGV0IGE9MDthPHIubGVuZ3RoO2ErKyl7Y29uc3QgdT1NYXRoLnBvdygyLGgtMSk7blthXVtjXT1NYXRoLnJvdW5kKHJbYV1bY10qdSkvdX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImNydXNoLXByb2Nlc3NvciIsU3QpO2NsYXNzIFR0IGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6InNoYXBlIixkZWZhdWx0VmFsdWU6MH0se25hbWU6InBvc3RnYWluIixkZWZhdWx0VmFsdWU6MX1dfWNvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnN0YXJ0ZWQ9ITF9cHJvY2Vzcyh0LGUscyl7Y29uc3Qgcj10WzBdLG49ZVswXSxpPXJbMF0hPT12b2lkIDA7aWYodGhpcy5zdGFydGVkJiYhaSlyZXR1cm4hMTt0aGlzLnN0YXJ0ZWQ9aTtsZXQgaD1zLnNoYXBlWzBdO2g9aDwxP2g6MS00ZS0xMCxoPTIqaC8oMS1oKTtjb25zdCBjPU1hdGgubWF4KC4wMDEsTWF0aC5taW4oMSxzLnBvc3RnYWluWzBdKSk7Zm9yKGxldCBhPTA7YTxEO2ErKylmb3IobGV0IHU9MDt1PHIubGVuZ3RoO3UrKyluW3VdW2FdPSgxK2gpKnJbdV1bYV0vKDEraCpNYXRoLmFicyhyW3VdW2FdKSkqYztyZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoInNoYXBlLXByb2Nlc3NvciIsVHQpO2Z1bmN0aW9uIFMobyl7Y29uc3QgdD1vKm87cmV0dXJuIG8qKDI3K3QpLygyNys5KnQpfWNvbnN0IHB0PTMuMTQxNTkyNjUzNTk7Y2xhc3MgUHQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiZnJlcXVlbmN5IixkZWZhdWx0VmFsdWU6NTAwfSx7bmFtZToicSIsZGVmYXVsdFZhbHVlOjF9LHtuYW1lOiJkcml2ZSIsZGVmYXVsdFZhbHVlOi42OX1dfWNvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnN0YXJ0ZWQ9ITEsdGhpcy5wMD1bMCwwXSx0aGlzLnAxPVswLDBdLHRoaXMucDI9WzAsMF0sdGhpcy5wMz1bMCwwXSx0aGlzLnAzMj1bMCwwXSx0aGlzLnAzMz1bMCwwXSx0aGlzLnAzND1bMCwwXX1wcm9jZXNzKHQsZSxzKXtjb25zdCByPXRbMF0sbj1lWzBdLGk9clswXSE9PXZvaWQgMDtpZih0aGlzLnN0YXJ0ZWQmJiFpKXJldHVybiExO3RoaXMuc3RhcnRlZD1pO2NvbnN0IGg9cy5xWzBdLGM9UihNYXRoLmV4cChzLmRyaXZlWzBdKSwuMSwyZTMpO2xldCBhPXMuZnJlcXVlbmN5WzBdO2E9YSoyKnB0L3NhbXBsZVJhdGUsYT1hPjE/MTphO2NvbnN0IHU9TWF0aC5taW4oOCxoKi4xMyk7bGV0IGY9MS9jKk1hdGgubWluKDEuNzUsMSt1KTtmb3IobGV0IHA9MDtwPEQ7cCsrKWZvcihsZXQgbD0wO2w8ci5sZW5ndGg7bCsrKXtjb25zdCBkPXRoaXMucDNbbF0qLjM2MDg5MSt0aGlzLnAzMltsXSouNDE3MjkrdGhpcy5wMzNbbF0qLjE3Nzg5Nit0aGlzLnAzNFtsXSouMDQzOTcyNTt0aGlzLnAzNFtsXT10aGlzLnAzM1tsXSx0aGlzLnAzM1tsXT10aGlzLnAzMltsXSx0aGlzLnAzMltsXT10aGlzLnAzW2xdLHRoaXMucDBbbF0rPShTKHJbbF1bcF0qYy11KmQpLVModGhpcy5wMFtsXSkpKmEsdGhpcy5wMVtsXSs9KFModGhpcy5wMFtsXSktUyh0aGlzLnAxW2xdKSkqYSx0aGlzLnAyW2xdKz0oUyh0aGlzLnAxW2xdKS1TKHRoaXMucDJbbF0pKSphLHRoaXMucDNbbF0rPShTKHRoaXMucDJbbF0pLVModGhpcy5wM1tsXSkpKmEsbltsXVtwXT1kKmZ9cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJsYWRkZXItcHJvY2Vzc29yIixQdCk7Y2xhc3MgeXQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiZGlzdG9ydCIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJwb3N0Z2FpbiIsZGVmYXVsdFZhbHVlOjF9XX1jb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5zdGFydGVkPSExfXByb2Nlc3ModCxlLHMpe2NvbnN0IHI9dFswXSxuPWVbMF0saT1yWzBdIT09dm9pZCAwO2lmKHRoaXMuc3RhcnRlZCYmIWkpcmV0dXJuITE7dGhpcy5zdGFydGVkPWk7Y29uc3QgaD1NYXRoLmV4cG0xKHMuZGlzdG9ydFswXSksYz1NYXRoLm1heCguMDAxLE1hdGgubWluKDEscy5wb3N0Z2FpblswXSkpO2ZvcihsZXQgYT0wO2E8RDthKyspZm9yKGxldCB1PTA7dTxyLmxlbmd0aDt1Kyspblt1XVthXT0oMStoKSpyW3VdW2FdLygxK2gqTWF0aC5hYnMoclt1XVthXSkpKmM7cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJkaXN0b3J0LXByb2Nlc3NvciIseXQpO2Z1bmN0aW9uIEF0KG8sdCxlKXtyZXR1cm4gZSoodC1vKStvfWZ1bmN0aW9uIHh0KG8sdCxlKXtyZXR1cm4gbzwyPzA6QXQoLXQqLjUsdCouNSxlLyhvLTEpKX1mdW5jdGlvbiBydChvLHQpe3JldHVybiBvKk1hdGgucG93KDIsdC8xMil9Y2xhc3MgRnQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucGhhc2U9W119c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiYmVnaW4iLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJlbmQiLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTo0NDAsbWluOk51bWJlci5FUFNJTE9OfSx7bmFtZToicGFuc3ByZWFkIixkZWZhdWx0VmFsdWU6LjQsbWluOjAsbWF4OjF9LHtuYW1lOiJmcmVxc3ByZWFkIixkZWZhdWx0VmFsdWU6LjIsbWluOjB9LHtuYW1lOiJkZXR1bmUiLGRlZmF1bHRWYWx1ZTowLG1pbjowfSx7bmFtZToidm9pY2VzIixkZWZhdWx0VmFsdWU6NSxtaW46MX1dfXByb2Nlc3ModCxlLHMpe2lmKGN1cnJlbnRUaW1lPD1zLmJlZ2luWzBdKXJldHVybiEwO2lmKGN1cnJlbnRUaW1lPj1zLmVuZFswXSlyZXR1cm4hMTtsZXQgcj1zLmZyZXF1ZW5jeVswXTtyPXIqTWF0aC5wb3coMixzLmRldHVuZVswXS8xMjAwKTtjb25zdCBuPWVbMF0saT1zLnZvaWNlc1swXSxoPXMuZnJlcXNwcmVhZFswXSxjPXMucGFuc3ByZWFkWzBdKi41Ky41LGE9TWF0aC5zcXJ0KDEtYyksdT1NYXRoLnNxcnQoYyk7Zm9yKGxldCBmPTA7ZjxpO2YrKyl7Y29uc3QgcD0oZiYxKT09MSxsPXJ0KHIseHQoaSxoLGYpKTtsZXQgZD1hLG09dTtwJiYoZD11LG09YSk7Y29uc3QgZz1sL3NhbXBsZVJhdGU7Zm9yKGxldCB2PTA7djxuWzBdLmxlbmd0aDt2Kyspe3RoaXMucGhhc2VbZl09dGhpcy5waGFzZVtmXT8/TWF0aC5yYW5kb20oKTtjb25zdCBJPXN0LnNhd2JsZXAodGhpcy5waGFzZVtmXSxnKTtuWzBdW3ZdPW5bMF1bdl0rSSpkLG5bMV1bdl09blsxXVt2XStJKm0sdGhpcy5waGFzZVtmXSs9Zyx0aGlzLnBoYXNlW2ZdPjEmJih0aGlzLnBoYXNlW2ZdPXRoaXMucGhhc2VbZl0tMSl9fXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3Nvcigic3VwZXJzYXctb3NjaWxsYXRvciIsRnQpO2NvbnN0IFZ0PTIwNDg7ZnVuY3Rpb24gTXQobyl7bGV0IHQ9bmV3IEZsb2F0MzJBcnJheShvKTtmb3IodmFyIGU9MDtlPG87ZSsrKXRbZV09LjUqKDEtTWF0aC5jb3MoMipNYXRoLlBJKmUvbykpO3JldHVybiB0fWNsYXNzIE90IGV4dGVuZHMgdnR7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToicGl0Y2hGYWN0b3IiLGRlZmF1bHRWYWx1ZToxfV19Y29uc3RydWN0b3IodCl7dC5wcm9jZXNzb3JPcHRpb25zPXtibG9ja1NpemU6VnR9LHN1cGVyKHQpLHRoaXMuZmZ0U2l6ZT10aGlzLmJsb2NrU2l6ZSx0aGlzLnRpbWVDdXJzb3I9MCx0aGlzLmhhbm5XaW5kb3c9TXQodGhpcy5ibG9ja1NpemUpLHRoaXMuZmZ0PW5ldyBndCh0aGlzLmZmdFNpemUpLHRoaXMuZnJlcUNvbXBsZXhCdWZmZXI9dGhpcy5mZnQuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQ9dGhpcy5mZnQuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy50aW1lQ29tcGxleEJ1ZmZlcj10aGlzLmZmdC5jcmVhdGVDb21wbGV4QXJyYXkoKSx0aGlzLm1hZ25pdHVkZXM9bmV3IEZsb2F0MzJBcnJheSh0aGlzLmZmdFNpemUvMisxKSx0aGlzLnBlYWtJbmRleGVzPW5ldyBJbnQzMkFycmF5KHRoaXMubWFnbml0dWRlcy5sZW5ndGgpLHRoaXMubmJQZWFrcz0wfXByb2Nlc3NPTEEodCxlLHMpe2xldCByPXMucGl0Y2hGYWN0b3Jbcy5waXRjaEZhY3Rvci5sZW5ndGgtMV07cjwwJiYocj1yKi4yNSkscj1NYXRoLm1heCgwLHIrMSk7Zm9yKHZhciBuPTA7bjx0aGlzLm5iSW5wdXRzO24rKylmb3IodmFyIGk9MDtpPHRbbl0ubGVuZ3RoO2krKyl7dmFyIGg9dFtuXVtpXSxjPWVbbl1baV07dGhpcy5hcHBseUhhbm5XaW5kb3coaCksdGhpcy5mZnQucmVhbFRyYW5zZm9ybSh0aGlzLmZyZXFDb21wbGV4QnVmZmVyLGgpLHRoaXMuY29tcHV0ZU1hZ25pdHVkZXMoKSx0aGlzLmZpbmRQZWFrcygpLHRoaXMuc2hpZnRQZWFrcyhyKSx0aGlzLmZmdC5jb21wbGV0ZVNwZWN0cnVtKHRoaXMuZnJlcUNvbXBsZXhCdWZmZXJTaGlmdGVkKSx0aGlzLmZmdC5pbnZlcnNlVHJhbnNmb3JtKHRoaXMudGltZUNvbXBsZXhCdWZmZXIsdGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQpLHRoaXMuZmZ0LmZyb21Db21wbGV4QXJyYXkodGhpcy50aW1lQ29tcGxleEJ1ZmZlcixjKSx0aGlzLmFwcGx5SGFubldpbmRvdyhjKX10aGlzLnRpbWVDdXJzb3IrPXRoaXMuaG9wU2l6ZX1hcHBseUhhbm5XaW5kb3codCl7Zm9yKHZhciBlPTA7ZTx0aGlzLmJsb2NrU2l6ZTtlKyspdFtlXT10W2VdKnRoaXMuaGFubldpbmRvd1tlXSoxLjYyfWNvbXB1dGVNYWduaXR1ZGVzKCl7Zm9yKHZhciB0PTAsZT0wO3Q8dGhpcy5tYWduaXR1ZGVzLmxlbmd0aDspe2xldCBzPXRoaXMuZnJlcUNvbXBsZXhCdWZmZXJbZV0scj10aGlzLmZyZXFDb21wbGV4QnVmZmVyW2UrMV07dGhpcy5tYWduaXR1ZGVzW3RdPXMqKjIrcioqMix0Kz0xLGUrPTJ9fWZpbmRQZWFrcygpe3RoaXMubmJQZWFrcz0wO3ZhciB0PTI7bGV0IGU9dGhpcy5tYWduaXR1ZGVzLmxlbmd0aC0yO2Zvcig7dDxlOyl7bGV0IHM9dGhpcy5tYWduaXR1ZGVzW3RdO2lmKHRoaXMubWFnbml0dWRlc1t0LTFdPj1zfHx0aGlzLm1hZ25pdHVkZXNbdC0yXT49cyl7dCsrO2NvbnRpbnVlfWlmKHRoaXMubWFnbml0dWRlc1t0KzFdPj1zfHx0aGlzLm1hZ25pdHVkZXNbdCsyXT49cyl7dCsrO2NvbnRpbnVlfXRoaXMucGVha0luZGV4ZXNbdGhpcy5uYlBlYWtzXT10LHRoaXMubmJQZWFrcysrLHQrPTJ9fXNoaWZ0UGVha3ModCl7dGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQuZmlsbCgwKTtmb3IodmFyIGU9MDtlPHRoaXMubmJQZWFrcztlKyspe2xldCBpPXRoaXMucGVha0luZGV4ZXNbZV0saD1NYXRoLnJvdW5kKGkqdCk7aWYoaD50aGlzLm1hZ25pdHVkZXMubGVuZ3RoKWJyZWFrO3ZhciBzPTAscj10aGlzLmZmdFNpemU7aWYoZT4wKXtsZXQgdT10aGlzLnBlYWtJbmRleGVzW2UtMV07cz1pLU1hdGguZmxvb3IoKGktdSkvMil9aWYoZTx0aGlzLm5iUGVha3MtMSl7bGV0IHU9dGhpcy5wZWFrSW5kZXhlc1tlKzFdO3I9aStNYXRoLmNlaWwoKHUtaSkvMil9bGV0IGM9cy1pLGE9ci1pO2Zvcih2YXIgbj1jO248YTtuKyspe2xldCB1PWkrbixmPWgrbjtpZihmPj10aGlzLm1hZ25pdHVkZXMubGVuZ3RoKWJyZWFrO2xldCBwPTIqTWF0aC5QSSooZi11KS90aGlzLmZmdFNpemUsbD1NYXRoLmNvcyhwKnRoaXMudGltZUN1cnNvciksZD1NYXRoLnNpbihwKnRoaXMudGltZUN1cnNvciksbT11KjIsZz1tKzEsdj10aGlzLmZyZXFDb21wbGV4QnVmZmVyW21dLEk9dGhpcy5mcmVxQ29tcGxleEJ1ZmZlcltnXSxfPXYqbC1JKmQsdz12KmQrSSpsLGI9ZioyLEI9YisxO3RoaXMuZnJlcUNvbXBsZXhCdWZmZXJTaGlmdGVkW2JdKz1fLHRoaXMuZnJlcUNvbXBsZXhCdWZmZXJTaGlmdGVkW0JdKz13fX19fXJlZ2lzdGVyUHJvY2Vzc29yKCJwaGFzZS12b2NvZGVyLXByb2Nlc3NvciIsT3QpO2NsYXNzIE50IGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnBpPXB0LHRoaXMucGhpPS10aGlzLnBpLHRoaXMuWTA9MCx0aGlzLlkxPTAsdGhpcy5QVz10aGlzLnBpLHRoaXMuQj0yLjMsdGhpcy5kcGhpZj0wLHRoaXMuZW52Zj0wfXN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImJlZ2luIixkZWZhdWx0VmFsdWU6MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLG1pbjowfSx7bmFtZToiZW5kIixkZWZhdWx0VmFsdWU6MCxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLG1pbjowfSx7bmFtZToiZnJlcXVlbmN5IixkZWZhdWx0VmFsdWU6NDQwLG1pbjpOdW1iZXIuRVBTSUxPTn0se25hbWU6ImRldHVuZSIsZGVmYXVsdFZhbHVlOjAsbWluOk51bWJlci5ORUdBVElWRV9JTkZJTklUWSxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfSx7bmFtZToicHVsc2V3aWR0aCIsZGVmYXVsdFZhbHVlOjEsbWluOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWX1dfXByb2Nlc3ModCxlLHMpe2lmKHRoaXMuZGlzY29ubmVjdGVkKXJldHVybiExO2lmKGN1cnJlbnRUaW1lPD1zLmJlZ2luWzBdKXJldHVybiEwO2lmKGN1cnJlbnRUaW1lPj1zLmVuZFswXSlyZXR1cm4hMTtjb25zdCByPWVbMF07bGV0IG49MSxpO2ZvcihsZXQgaD0wO2g8KHJbMF0ubGVuZ3RoPz8wKTtoKyspe2NvbnN0IGM9KDEtUihxKGgscy5wdWxzZXdpZHRoKSwtLjk5LC45OSkpKnRoaXMucGksYT1xKGgscy5kZXR1bmUpLHU9cnQocShoLHMuZnJlcXVlbmN5KSxhLzEwMCk7aT11Kih0aGlzLnBpLyhzYW1wbGVSYXRlKi41KSksdGhpcy5kcGhpZis9LjEqKGktdGhpcy5kcGhpZiksbio9Ljk5OTgsdGhpcy5lbnZmKz0uMSoobi10aGlzLmVudmYpLHRoaXMuQj0yLjMqKDEtMWUtNCp1KSx0aGlzLkI8MCYmKHRoaXMuQj0wKSx0aGlzLnBoaSs9dGhpcy5kcGhpZix0aGlzLnBoaT49dGhpcy5waSYmKHRoaXMucGhpLT0yKnRoaXMucGkpO2xldCBmPU1hdGguY29zKHRoaXMucGhpK3RoaXMuQip0aGlzLlkwKTt0aGlzLlkwPS41KihmK3RoaXMuWTApO2xldCBwPU1hdGguY29zKHRoaXMucGhpK3RoaXMuQip0aGlzLlkxK2MpO3RoaXMuWTE9LjUqKHArdGhpcy5ZMSk7Zm9yKGxldCBsPTA7bDxyLmxlbmd0aDtsKyspcltsXVtoXT0uMTUqKGYtcCkqdGhpcy5lbnZmfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigicHVsc2Utb3NjaWxsYXRvciIsTnQpO2NvbnN0IG50PXtiaXRDOmZ1bmN0aW9uKG8sdCxlKXtyZXR1cm4gbyZ0P2U6MH0sYnI6ZnVuY3Rpb24obyx0PTgpe2lmKHQ+MzIpdGhyb3cgbmV3IEVycm9yKCJicigpIFNpemUgY2Fubm90IGJlIGdyZWF0ZXIgdGhhbiAzMiIpO3tsZXQgZT0wO2ZvcihsZXQgcz0wO3M8dC0wO3MrKyllKz1udC5iaXRDKG8sMioqcywyKioodC0ocysxKSkpO3JldHVybiBlfX0sc2luZjpmdW5jdGlvbihvKXtyZXR1cm4gTWF0aC5zaW4oby8oMTI4L01hdGguUEkpKX0sY29zZjpmdW5jdGlvbihvKXtyZXR1cm4gTWF0aC5jb3Moby8oMTI4L01hdGguUEkpKX0sdGFuZjpmdW5jdGlvbihvKXtyZXR1cm4gTWF0aC50YW4oby8oMTI4L01hdGguUEkpKX0scmVnRzpmdW5jdGlvbihvLHQpe3JldHVybiB0LnRlc3Qoby50b1N0cmluZygyKSl9fTtsZXQgVyx0dDtmdW5jdGlvbiBDdChvKXtpZigoV3x8dHQpPT1udWxsKXtXPU9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKE1hdGgpLHR0PVcubWFwKHM9Pk1hdGhbc10pO2NvbnN0IHQ9T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMobnQpLGU9dC5tYXAocz0+bnRbc10pO1cucHVzaCgiaW50Iiwid2luZG93IiwuLi50KSx0dC5wdXNoKE1hdGguZmxvb3IsZ2xvYmFsVGhpcywuLi5lKX1yZXR1cm4gbmV3IEZ1bmN0aW9uKC4uLlcsInQiLGByZXR1cm4gMCwKJHtvfHwwfTtgKS5iaW5kKGdsb2JhbFRoaXMsLi4udHQpfWNsYXNzIGt0IGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnBvcnQub25tZXNzYWdlPXQ9PntsZXR7Y29kZVRleHQ6ZX09dC5kYXRhO2NvbnN0e2J5dGVCZWF0U3RhcnRUaW1lOnN9PXQuZGF0YTtzIT1udWxsJiYodGhpcy50PTAsdGhpcy5pbml0aWFsT2Zmc2V0PU1hdGguZmxvb3IocykpLGU9ZS50cmltKCkucmVwbGFjZSgvXmV2YWxcKHVuZXNjYXBlXChlc2NhcGUoPzpgfFwoJ3xcKCJ8XChgKSguKj8pKD86YHwnXCl8IlwpfGBcKSkucmVwbGFjZVwoXC91XChcLlwuXClcL2csWyInYF1cJDElWyInYF1cKVwpXCkkLywocixuKT0+dW5lc2NhcGUoZXNjYXBlKG4pLnJlcGxhY2UoL3UoLi4pL2csIiQxJSIpKSksdGhpcy5mdW5jPUN0KGUpfSx0aGlzLmluaXRpYWxPZmZzZXQ9bnVsbCx0aGlzLnQ9bnVsbCx0aGlzLmZ1bmM9bnVsbH1zdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJiZWdpbiIsZGVmYXVsdFZhbHVlOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWSxtaW46MH0se25hbWU6ImZyZXF1ZW5jeSIsZGVmYXVsdFZhbHVlOjQ0MCxtaW46TnVtYmVyLkVQU0lMT059LHtuYW1lOiJkZXR1bmUiLGRlZmF1bHRWYWx1ZTowLG1pbjpOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWX0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWSxtaW46MH1dfXByb2Nlc3ModCxlLHMpe2lmKHRoaXMuZGlzY29ubmVjdGVkKXJldHVybiExO2lmKGN1cnJlbnRUaW1lPD1zLmJlZ2luWzBdKXJldHVybiEwO2lmKGN1cnJlbnRUaW1lPj1zLmVuZFswXSlyZXR1cm4hMTt0aGlzLnQ9PW51bGwmJih0aGlzLnQ9cy5iZWdpblswXSpzYW1wbGVSYXRlKTtjb25zdCByPWVbMF07Zm9yKGxldCBuPTA7bjxyWzBdLmxlbmd0aDtuKyspe2NvbnN0IGk9cShuLHMuZGV0dW5lKSxoPXJ0KHEobixzLmZyZXF1ZW5jeSksaS8xMDApO2xldCBjPXRoaXMudC8oc2FtcGxlUmF0ZS8yNTYpKmgrdGhpcy5pbml0aWFsT2Zmc2V0O2NvbnN0IGY9KCh0aGlzLmZ1bmMoYykmMjU1KS8xMjcuNS0xKSouMjtmb3IobGV0IHA9MDtwPHIubGVuZ3RoO3ArKylyW3BdW25dPVIoZiwtLjQsLjQpO3RoaXMudD10aGlzLnQrMX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImJ5dGUtYmVhdC1wcm9jZXNzb3IiLGt0KX0pKCk7Cg==";function C(e){const t=V().createGain();return t.gain.value=e,t}const bt=(e,t,n,a)=>a-n===0?0:(t-e)/(a-n);function P(e,t,n,a){const c=new AudioWorkletNode(e,t,a);return Object.entries(n).forEach(([l,s])=>{c.parameters.get(l).value=s}),c}const Q=(e,t,n,a,c,l,s,o,d,r="exponential")=>{t=j(t),n=j(n),a=j(a),c=j(c);const i=r==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";r==="exponential"&&(l=l===0?.001:l,s=s===0?.001:s);const b=s-l,u=s,m=l+a*b,X=d-o,Z=y=>{let h;if(t>y){let p=bt(l,u,0,t);h=y*p+(l>u?l:0)}else h=(y-t)*bt(u,m,0,n)+u;return r==="exponential"&&(h=h||.001),h};e.setValueAtTime(l,o),t>X?e[i](Z(X),d):t+n>X?(e[i](Z(t),o+t),e[i](Z(X),d)):(e[i](Z(t),o+t),e[i](Z(t+n),o+t+n),e.setValueAtTime(m,d)),e[i](l,d+c)};function tn(e,t,n,a,c,l){const s={threshold:t??-3,ratio:n??10,knee:a??10,attack:c??.005,release:l??.05};return new DynamicsCompressorNode(e,s)}const B=(e,t="linear",n)=>{const[a,c,l,s]=e;if(a==null&&c==null&&l==null&&s==null)return n??[.001,.001,1,.01];const o=l??(a!=null&&c==null||a==null&&c==null?1:.001);return[Math.max(a??0,.001),Math.max(c??0,.001),Math.min(o,1),Math.max(s??0,.01)]};function Le(e,t,n,a,c,l,s,o,d,r,i,b,u,m){const X="exponential",[Z,y,h,p]=B([c,l,s,o],X,[.005,.14,0,.1]);let W,M;if(u==="ladder"?(W=P(e,"ladder-processor",{frequency:n,q:a,drive:m}),M=W.parameters.get("frequency")):(W=e.createBiquadFilter(),W.type=t,W.Q.value=a,W.frequency.value=n,M=W.frequency),(c??l??s??o??d)!==void 0){d=j(d,1,!0),b=j(b,0,!0);const G=Math.abs(d),R=G*b;let H=se(2**-R*n,0,2e4),g=se(2**(G-R)*n,0,2e4);return d<0&&([H,g]=[g,H]),Q(M,Z,y,h,p,H,g,r,i,X),W}return W}let mt=e=>e<.5?1:1-(e-.5)/.5;function nn(e,t,n=0){const a=V();if(!n)return e;let c=a.createGain(),l=a.createGain();e.connect(c),t.connect(l),c.gain.value=mt(n),l.gain.value=mt(1-n);let s=a.createGain();return c.connect(s),l.connect(s),s}let an=["linear","exponential"];function pe(e,t,n,a){if(!(t.pattack??t.pdecay??t.psustain??t.prelease??t.penv))return;const c=j(t.penv,1,!0),l=an[t.pcurve??0];let[s,o,d,r]=B([t.pattack,t.pdecay,t.psustain,t.prelease],l,[.2,.001,1,.001]),i=t.panchor??d;const b=c*100,u=0-b*i,m=b-b*i;Q(e,s,o,d,r,u,m,n,a,l)}function ye(e,t,n){const{vibmod:a=.5,vib:c}=t;let l;if(c>0){l=V().createOscillator(),l.frequency.value=c;const s=V().createGain();return s.gain.value=a*100,l.connect(s),s.connect(e),l.start(n),l}}function ge(e,t,n,a){const c=e.createConstantSource();return c.start(n),c.stop(a),c.onended=()=>{t()},c}const cn=(e,t=1,n="sine")=>{const a=V(),c=a.createOscillator();c.type=n,c.frequency.value=e,c.start();const l=new GainNode(a,{gain:t});return c.connect(l),{node:l,stop:s=>c.stop(s)}},ln=(e,t,n,a="sine")=>{const c=e.value*t,l=c*n;return cn(c,l,a)};function Ye(e,t,n){const{fmh:a=1,fmi:c,fmenv:l="exp",fmattack:s,fmdecay:o,fmsustain:d,fmrelease:r,fmvelocity:i,fmwave:b="sine",duration:u}=t;let m,X=()=>{};if(c){const Z=V().createGain(),y=ln(e,a,c,b);if(m=y.node,X=y.stop,![s,o,d,r,i].find(h=>h!==void 0))m.connect(e);else{const[h,p,W,M]=B([s,o,d,r]),G=n+u;Q(Z.gain,h,p,W,M,0,1,n,G,l==="exp"?"exponential":"linear"),m.connect(Z),Z.connect(e)}}return{stop:X}}const ke={},Ke={},Pn=e=>ke[e];function sn(e,t){var n=1024;if(e<n)return e+" B";var a=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],c=-1;do e/=n,++c;while(e>=n);return e.toFixed(1)+" "+a[c]}function on(e,t){const{s:n,n:a=0,speed:c=1}=e;let l=_t(e,36),s=l-36,o,d=0;if(Array.isArray(t))d=ut(a,t.length),o=t[d];else{const b=m=>Ge(m)-l,u=Object.keys(t).filter(m=>!m.startsWith("_")).reduce((m,X,Z)=>!m||Math.abs(b(X))<Math.abs(b(m))?X:m,null);s=-b(u),d=ut(a,t[u].length),o=t[u][d]}const r=`${n}:${d}`;let i=Math.abs(c)*Math.pow(2,s/12);return{transpose:s,sampleUrl:o,index:d,midi:l,label:r,playbackRate:i}}const dn=async(e,t,n)=>{let{sampleUrl:a,label:c,playbackRate:l}=on(e,t);n&&(a=await n(a));const s=V(),o=await Gt(a,s,c);return e.unit==="c"&&(l=l*o.duration),{buffer:o,playbackRate:l}},rn=async(e,t,n)=>{let{buffer:a,playbackRate:c}=await dn(e,t,n);e.speed<0&&(a=un(a));const l=V().createBufferSource();l.buffer=a,l.playbackRate.value=c;const{s,loopBegin:o=0,loopEnd:d=1,begin:r=0,end:i=1}=e,b=r*l.buffer.duration;(s.startsWith("wt_")||e.loop)&&(l.loop=!0,l.loopStart=o*l.buffer.duration-b,l.loopEnd=d*l.buffer.duration-b);const u=l.buffer.duration/l.playbackRate.value,m=(i-r)*u;return{bufferSource:l,offset:b,bufferDuration:u,sliceDuration:m}},Gt=(e,t,n,a=0)=>{const c=n?`sound "${n}:${a}"`:"sample";if(e=e.replace("#","%23"),!Ke[e]){w(`[sampler] load ${c}..`,"load-sample",{url:e});const l=Date.now();Ke[e]=fetch(e).then(s=>s.arrayBuffer()).then(async s=>{const o=Date.now()-l,d=sn(s.byteLength);w(`[sampler] load ${c}... done! loaded ${d} in ${o}ms`,"loaded-sample",{url:e});const r=await t.decodeAudioData(s);return ke[e]=r,r})}return Ke[e]};function un(e){const t=V(),n=t.createBuffer(e.numberOfChannels,e.length,t.sampleRate);for(let a=0;a<e.numberOfChannels;a++)n.copyToChannel(e.getChannelData(a).slice().reverse(),a,a);return n}const Cn=e=>ke[e];function Vt(e){if(e.startsWith("bubo:")){const[t,n]=e.split(":");e=`github:Bubobubobubobubo/dough-${n}`}return e}function Wt(e,t=""){if(!e.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,a]=e.split("github:");return a=a.endsWith("/")?a.slice(0,-1):a,a.split("/").length===2&&(a+="/main"),`https://raw.githubusercontent.com/${a}/${t}`}const bn=(e,t,n=e._base||"")=>Object.entries(e).forEach(([a,c])=>{if(typeof c=="string"&&(c=[c]),typeof c!="object")throw new Error("wrong sample map format for "+a);n=c._base||n,n=Vt(n),n.startsWith("github:")&&(n=Wt(n,""));const l=s=>n+s;Array.isArray(c)?c=c.map(l):c=Object.fromEntries(Object.entries(c).map(([s,o])=>[s,(typeof o=="string"?[o]:o).map(l)])),t(a,c)});let ft={};function Qn(e,t){ft[e]=t}function mn(e){const t=Object.entries(ft).find(([n])=>e.startsWith(n));if(t)return t[1]}const Zn=async(e,t=e._base||"",n={})=>{if(typeof e=="string"){const l=mn(e);if(l)return l(e);if(e=Vt(e),e.startsWith("github:")&&(e=Wt(e,"strudel.json")),e.startsWith("local:")&&(e="http://localhost:5432"),e.startsWith("shabda:")){let[o,d]=e.split("shabda:");e=`https://shabda.ndre.gr/${d}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[o,d]=e.split("shabda/speech");d=d.startsWith("/")?d.substring(1):d;let[r,i]=d.split(":"),b="f",u="en-GB";r&&([u,b]=r.split("/")),e=`https://shabda.ndre.gr/speech/${i}.json?gender=${b}&language=${u}&strudel=1'`}if(typeof fetch!="function")return;const s=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(o=>o.json()).then(o=>Zn(o,t||o._base||s,n)).catch(o=>{throw console.error(o),new Error(`error loading "${e}"`)})}const{prebake:a,tag:c}=n;bn(e,(l,s)=>q(l,(o,d,r)=>Xn(o,d,r,s),{type:"sample",samples:s,baseUrl:t,prebake:a,tag:c}),t)},Zt=[];async function Xn(e,t,n,a,c){let{s:l,nudge:s=0,cut:o,loop:d,clip:r=void 0,n:i=0,speed:b=1,duration:u}=t;if(b===0)return;const m=V();let[X,Z,y,h]=B([t.attack,t.decay,t.sustain,t.release]);const{bufferSource:p,sliceDuration:W,offset:M}=await rn(t,a,c);if(m.currentTime>e){w(`[sampler] still loading sound "${l}:${i}"`,"highlight");return}if(!p){w(`[sampler] could not load "${l}:${i}"`,"error");return}let G=ye(p.detune,t,e);const R=e+s;p.start(R,M);const H=m.createGain(),g=p.connect(H);r==null&&d==null&&t.release==null&&(u=W);let N=e+u;Q(g.gain,X,Z,y,h,0,1,e,N,"linear"),pe(p.detune,t,e,N);const K=m.createGain();g.connect(K),p.onended=function(){p.disconnect(),G==null||G.stop(),g.disconnect(),K.disconnect(),n()};let U=N+h+.01;p.stop(U);const x={node:K,bufferSource:p,stop:T=>{p.stop(T)}};if(o!==void 0){const T=Zt[o];T&&(T.node.gain.setValueAtTime(1,R),T.node.gain.linearRampToValueAtTime(0,R+.01)),Zt[o]=x}return x}const Mt=128,we="System Standard";let xt=Mt;function pn(e){xt=parseInt(e)??Mt}let zt=!1;function yn(e){zt=e==!0}const oe=jt();function q(e,t,n={}){e=e.toLowerCase().replace(/\s+/g,"_"),oe.setKey(e,{onTrigger:t,data:n})}let Rt=e=>e;function _(e){return Rt(e)}function Bn(e){Rt=e}function Je(e){for(const n in e)e[n.toLowerCase()]=e[n];const t=oe.get();for(const n in t){const[a,c]=n.split("_");if(!c)continue;const l=e[a];if(l){if(typeof l=="string")t[`${l}_${c}`.toLowerCase()]=t[n];else if(Array.isArray(l))for(const s of l)t[`${s}_${c}`.toLowerCase()]=t[n]}}oe.set({...t})}async function hn(e){const t=await(await fetch(e)).json();Je(t)}async function jn(...e){switch(e.length){case 1:return typeof e[0]=="string"?hn(e[0]):Je(e[0]);case 2:return Je({[e[0]]:e[1]});default:throw new Error("aliasMap expects 1 or 2 arguments, received "+e.length)}}function Se(e){return oe.get()[e.toLowerCase()]}const Gn=async()=>{await navigator.mediaDevices.getUserMedia({audio:!0});let e=await navigator.mediaDevices.enumerateDevices();e=e.filter(n=>n.kind==="audiooutput"&&n.deviceId!=="default");const t=new Map;return t.set(we,""),e.forEach(n=>{t.set(n.label,n.deviceId)}),t},Lt={s:"triangle",gain:.8,postgain:1,density:".03",ftype:"12db",fanchor:0,resonance:1,hresonance:1,bandq:1,channels:[1,2],phaserdepth:.75,shapevol:1,distortvol:1,delay:0,byteBeatExpression:"0",delayfeedback:.5,delaytime:.25,orbit:1,i:1,velocity:1,fft:8};let Pe=new Map(Object.entries(Lt));function gt(e,t){Pe.set(e,t)}function L(e){return Pe.get(e)}function Un(e){Object.keys(e).forEach(t=>{gt(t,e[t])})}function Vn(){Pe=new Map(Object.entries(Lt))}function On(e){Vn(),e==="1.0"&&gt("fanchor",.5)}const En=()=>oe.set({});let ve;const Wn=()=>(ve=new AudioContext,ve),V=()=>ve||Wn();function Dn(){return V().currentTime}let He;function fn(){return He||(He=V().audioWorklet.addModule(en)),He}async function Mn(e={}){const{disableWorklets:t=!1,maxPolyphony:n,audioDeviceName:a=we,multiChannelOrbits:c=!1}=e;if(pn(n),yn(c),typeof window>"u")return;const l=V();if(a!=null&&a!=we)try{const s=(await Gn()).get(a),o=(s??"").length>0;l.sinkId!==s&&o&&await l.setSinkId(s),w(`[superdough] Audio Device set to ${a}, it might take a few seconds before audio plays on all output channels`)}catch{w("[superdough] failed to set audio interface","warning")}if(await l.resume(),t){w("[superdough]: AudioWorklets disabled with disableWorklets");return}try{await fn(),w("[superdough] AudioWorklets loaded")}catch(s){console.warn("could not load AudioWorklet effects",s)}w("[superdough] ready")}let Te;async function An(e){return Te||(Te=new Promise(t=>{document.addEventListener("click",async function n(){document.removeEventListener("click",n),await Mn(e),t()})})),Te}let A={},he,ee;function xn(){const e=V(),t=e.destination.maxChannelCount;e.destination.channelCount=t,he=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),ee=new GainNode(e),he.connect(ee),ee.connect(e.destination)}const Ce=(e,t=[0,1])=>{const n=V();he==null&&xn();const a=new StereoPannerNode(n);e.connect(a);const c=new ChannelSplitterNode(n,{numberOfOutputs:a.channelCount});a.connect(c),t.forEach((l,s)=>{c.connect(he,s%a.channelCount,l%n.destination.channelCount)})},qn=()=>{ee!=null&&(ee.gain.linearRampToValueAtTime(0,V().currentTime+.01),ee=null)};function zn(e,t,n,a,c){var l;if(n=se(n,0,.98),!A[e]){const s=V().createFeedbackDelay(1,t,n);(l=s.start)==null||l.call(s,a),Ce(s,c),A[e]=s}return A[e].delayTime.value!==t&&A[e].delayTime.setValueAtTime(t,a),A[e].feedback.value!==n&&A[e].feedback.setValueAtTime(n,a),A[e]}function Kt(e,t,n,a={}){return P(e,"lfo-processor",{frequency:1,depth:1,skew:0,phaseoffset:0,time:t,end:n,shape:1,dcoffset:-.5,...a})}function Rn(e,t,n=1,a=.5,c=1e3,l=2e3){const s=V(),o=Kt(s,e,t,{frequency:n,depth:l*2}),d=2;let r=0;const i=[];for(let b=0;b<d;b++){const u=s.createBiquadFilter();u.type="notch",u.gain.value=1,u.frequency.value=c+r,u.Q.value=2-Math.min(Math.max(a*2,0),1.9),o.connect(u.detune),r+=282,b>0&&i[b-1].connect(u),i.push(u)}return i[i.length-1]}function Ln(e){e=e??0;const t=["12db","ladder","24db"];return typeof e=="number"?t[Math.floor(ht(e,t.length))]:e}let I={},me=(e,t)=>e!==void 0&&e!==t;function gn(e,t,n,a,c,l,s){if(!I[e]){const o=V().createReverb(t,n,a,c,l);Ce(o,s),I[e]=o}return(me(t,I[e].duration)||me(n,I[e].fade)||me(a,I[e].lp)||me(c,I[e].dim)||I[e].ir!==l)&&I[e].generate(t,n,a,c,l),I[e]}let k={},te={};function Kn(e,t=1024,n=.5){if(!k[e]){const a=V().createAnalyser();a.fftSize=t,a.smoothingTimeConstant=n,k[e]=a,te[e]=new Float32Array(k[e].frequencyBinCount)}return k[e].fftSize!==t&&(k[e].fftSize=t,te[e]=new Float32Array(k[e].frequencyBinCount)),k[e]}function $n(e="time",t=1){const n={time:()=>{var a;return(a=k[t])==null?void 0:a.getFloatTimeDomainData(te[t])},frequency:()=>{var a;return(a=k[t])==null?void 0:a.getFloatFrequencyData(te[t])}}[e];if(!n)throw new Error(`getAnalyzerData: ${e} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),te[t]}function Ne(e,t,n){const a=C(n);return e.connect(a),a.connect(t),a}function _n(){A={},I={},k={},te={}}let le=new Map;function Xt(e){return(Array.isArray(e)?e:[e]).map(t=>t-1)}const Sn=async(e,t,n,a)=>{var st,ot,dt;const c=V();t=typeof t=="string"&&t.startsWith("=")?Number(t.slice(1)):c.currentTime+t;let{stretch:l}=e;if(l!=null&&(t=t-.04),typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");if(e.duration=n,t<c.currentTime){console.warn(`[superdough]: cannot schedule sounds in the past (target: ${t.toFixed(2)}, now: ${c.currentTime.toFixed(2)})`);return}let{s=L("s"),bank:o,source:d,gain:r=L("gain"),postgain:i=L("postgain"),density:b=L("density"),fanchor:u=L("fanchor"),drive:m=.69,cutoff:X,lpenv:Z,lpattack:y,lpdecay:h,lpsustain:p,lprelease:W,resonance:M=L("resonance"),hpenv:G,hcutoff:R,hpattack:H,hpdecay:g,hpsustain:N,hprelease:K,hresonance:U=L("hresonance"),bpenv:x,bandf:T,bpattack:Ve,bpdecay:We,bpsustain:J,bprelease:ne,bandq:O=L("bandq"),phaserrate:de,phaserdepth:Qe=L("phaserdepth"),phasersweep:Tt,phasercenter:Nt,coarse:Be,crush:je,shape:Ue,shapevol:fe=L("shapevol"),distort:Oe,distortvol:Me=L("distortvol"),pan:Ee,vowel:De,delay:re=L("delay"),delayfeedback:Ae=L("delayfeedback"),delaytime:qe=L("delaytime"),orbit:ae=L("orbit"),room:$e,roomfade:Ft,roomlp:Yt,roomdim:wt,roomsize:Jt,ir:xe,i:_e=L("i"),velocity:ze=L("velocity"),analyze:et,fft:vt=L("fft"),compressor:tt,compressorRatio:It,compressorKnee:kt,compressorAttack:Pt,compressorRelease:Ct}=e;const Re=Xt(zt&&ae>0?[ae*2-1,ae*2]:L("channels")),Qt=e.channels!=null?Xt(e.channels):Re;r=_(j(r,1)),i=_(i),fe=_(fe),Me=_(Me),re=_(re),ze=_(ze),r*=ze;const nt=Math.round(Math.random()*1e6);for(let f=0;f<=le.size-xt;f++){const v=le.entries().next(),S=v.value[1],E=v.value[0],rt=t+.25;(ot=(st=S==null?void 0:S.node)==null?void 0:st.gain)==null||ot.linearRampToValueAtTime(0,rt),(dt=S==null?void 0:S.stop)==null||dt.call(S,rt),le.delete(E)}let $=[];o&&s&&(s=`${o}_${s}`,e.s=s);let ie;if(d)ie=d(t,e,n,a);else if(Se(s)){const{onTrigger:f}=Se(s),v=await f(t,e,()=>{$.forEach(S=>S==null?void 0:S.disconnect()),le.delete(nt)});v&&(ie=v.node,le.set(nt,v))}else throw new Error(`sound ${s} not found! Is it loaded?`);if(!ie)return;if(c.currentTime>t){w("[webaudio] skip hap: still loading",c.currentTime-t);return}const z=[];z.push(ie),l!==void 0&&z.push(P(c,"phase-vocoder-processor",{pitchFactor:l})),z.push(C(r));const ue=Ln(e.ftype);if(X!==void 0){let f=()=>Le(c,"lowpass",X,M,y,h,p,W,Z,t,t+n,u,ue,m);z.push(f()),ue==="24db"&&z.push(f())}if(R!==void 0){let f=()=>Le(c,"highpass",R,U,H,g,N,K,G,t,t+n,u);z.push(f()),ue==="24db"&&z.push(f())}if(T!==void 0){let f=()=>Le(c,"bandpass",T,O,Ve,We,J,ne,x,t,t+n,u);z.push(f()),ue==="24db"&&z.push(f())}if(De!==void 0){const f=c.createVowelFilter(De);z.push(f)}if(Be!==void 0&&z.push(P(c,"coarse-processor",{coarse:Be})),je!==void 0&&z.push(P(c,"crush-processor",{crush:je})),Ue!==void 0&&z.push(P(c,"shape-processor",{shape:Ue,postgain:fe})),Oe!==void 0&&z.push(P(c,"distort-processor",{distort:Oe,postgain:Me})),tt!==void 0&&z.push(tn(c,tt,It,kt,Pt,Ct)),Ee!==void 0){const f=c.createStereoPanner();f.pan.value=2*Ee-1,z.push(f)}if(de!==void 0&&Qe>0){const f=Rn(t,t+n,de,Qe,Nt,Tt);z.push(f)}const ce=new GainNode(c,{gain:i});z.push(ce),Ce(ce,Qt);let at;if(re>0&&qe>0&&Ae>0){const f=zn(ae,qe,Ae,t,Re);at=Ne(ce,f,re),$.push(at)}let ct;if($e>0){let f;if(xe!==void 0){let S,E=Se(xe);Array.isArray(E)?S=E.data.samples[_e%E.data.samples.length]:typeof E=="object"&&(S=Object.values(E.data.samples).flat()[_e%Object.values(E.data.samples).length]),f=await Gt(S,c,xe,0)}const v=gn(ae,Jt,Ft,Yt,wt,f,Re);ct=Ne(ce,v,$e),$.push(ct)}let lt;if(et){const f=Kn(et,2**(vt+5));lt=Ne(ce,f,1),$.push(lt)}z.slice(1).reduce((f,v)=>f.connect(v),z[0]),$=$.concat(z)},ea=(e,t,n,a)=>{Sn(t,e-n,t.duration/a,a)};let Fe={};function Hn(e,t){const n=V();if(Fe[e])return Fe[e];const a=2*n.sampleRate,c=n.createBuffer(1,a,n.sampleRate),l=c.getChannelData(0);let s=0,o,d,r,i,b,u,m;o=d=r=i=b=u=m=0;for(let X=0;X<a;X++)if(e==="white")l[X]=Math.random()*2-1;else if(e==="brown"){let Z=Math.random()*2-1;l[X]=(s+.02*Z)/1.02,s=l[X]}else if(e==="pink"){let Z=Math.random()*2-1;o=.99886*o+Z*.0555179,d=.99332*d+Z*.0750759,r=.969*r+Z*.153852,i=.8665*i+Z*.3104856,b=.55*b+Z*.5329522,u=-.7616*u-Z*.016898,l[X]=o+d+r+i+b+u+m+Z*.5362,l[X]*=.11,m=Z*.115926}else if(e==="crackle"){const Z=t*.01;Math.random()<Z?l[X]=Math.random()*2-1:l[X]=0}return e!=="crackle"&&(Fe[e]=c),c}function St(e="white",t,n=.02){const a=V().createBufferSource();return a.buffer=Hn(e,n),a.loop=!0,a.start(t),{node:a,stop:c=>a.stop(c)}}function Tn(e,t,n){const a=St("pink",n);return{node:nn(e,a.node,t),stop:c=>a==null?void 0:a.stop(c)}}const Xe=e=>{let{note:t,freq:n}=e;return t=t||36,typeof t=="string"&&(t=Ge(t)),!n&&typeof t=="number"&&(n=yt(t)),Number(n)};function Ze(e){var t;e!=null&&(e.disconnect(),(t=e.parameters.get("end"))==null||t.setValueAtTime(0,0))}const Nn=["triangle","square","sawtooth","sine"],Fn=["pink","white","brown","crackle"];function ta(){[...Nn].forEach(e=>{q(e,(t,n,a)=>{const[c,l,s,o]=B([n.attack,n.decay,n.sustain,n.release],"linear",[.001,.05,.6,.01]);let d=wn(e,t,n),{node:r,stop:i,triggerRelease:b}=d;const u=C(.3),{duration:m}=n;r.onended=()=>{r.disconnect(),u.disconnect(),a()};const X=C(1);let Z=r.connect(u).connect(X);const y=t+m;Q(Z.gain,c,l,s,o,0,1,t,y,"linear");const h=y+o+.01;return b==null||b(h),i(h),{node:Z,stop:p=>{i(p)}}},{type:"synth",prebake:!0})}),q("supersaw",(e,t,n)=>{const a=V();let{duration:c,n:l,unison:s=5,spread:o=.6,detune:d}=t;d=d??l??.18;const r=Xe(t),[i,b,u,m]=B([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]),X=e+c,Z=X+m+.01,y=se(s,1,100);let h=y>1?se(o,0,1):0,p=P(a,"supersaw-oscillator",{frequency:r,begin:e,end:Z,freqspread:d,voices:y,panspread:h},{outputChannelCount:[2]});const W=1/Math.sqrt(y);pe(p.parameters.get("detune"),t,e,X);const M=ye(p.parameters.get("detune"),t,e),G=Ye(p.parameters.get("frequency"),t,e);let R=C(1);R=p.connect(R),Q(R.gain,i,b,u,m,0,.3*W,e,X,"linear");let H=ge(a,()=>{Ze(p),R.disconnect(),n(),G==null||G.stop(),M==null||M.stop()},e,Z);return{node:R,stop:g=>{H.stop(g)}}},{prebake:!0,type:"synth"}),q("bytebeat",(e,t,n)=>{const a=["(t%255 >= t/255%255)*255","(t*(t*8%60 <= 300)|(-t)*(t*4%512 < 256))+t/400","t","t*(t >> 10^t)","t&128","t&t>>8","((t%255+t%128+t%64+t%32+t%16+t%127.8+t%64.8+t%32.8+t%16.8)/3)","((t%64+t%63.8+t%64.15+t%64.35+t%63.5)/1.25)","(t&(t>>7)-t)","(sin(t*PI/128)*127+127)","((t^t/2+t+64*(sin((t*PI/64)+(t*PI/32768))+64))%128*2)","((t^t/2+t+64*(cos >> 0))%127.85*2)","((t^t/2+t+64)%128*2)","(((t * .25)^(t * .25)/100+(t * .25))%128)*2","((t^t/2+t+64)%7 * 24)"],{n:c=0}=t,l=Xe(t),{byteBeatExpression:s=a[c%a.length],byteBeatStartTime:o}=t,d=V();let{duration:r}=t;const[i,b,u,m]=B([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]),X=e+r,Z=X+m+.01;let y=P(d,"byte-beat-processor",{frequency:l,begin:e,end:Z},{outputChannelCount:[2]});y.port.postMessage({codeText:s,byteBeatStartTime:o,frequency:l});let h=C(1);h=y.connect(h),Q(h.gain,i,b,u,m,0,1,e,X,"linear");let p=ge(d,()=>{Ze(y),h.disconnect(),n()},e,Z);return{node:h,stop:W=>{p.stop(W)}}},{prebake:!0,type:"synth"}),q("pulse",(e,t,n)=>{const a=V();let{pwrate:c,pwsweep:l}=t;l==null&&(c!=null?l=.3:l=0),c==null&&l!=null&&(c=1);let{duration:s,pw:o=.5}=t;const d=Xe(t),[r,i,b,u]=B([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]),m=e+s,X=m+u+.01;let Z=P(a,"pulse-oscillator",{frequency:d,begin:e,end:X,pulsewidth:o},{outputChannelCount:[2]});pe(Z.parameters.get("detune"),t,e,m);const y=ye(Z.parameters.get("detune"),t,e),h=Ye(Z.parameters.get("frequency"),t,e);let p=C(1);p=Z.connect(p),Q(p.gain,r,i,b,u,0,1,e,m,"linear");let W;l!=0&&(W=Kt(a,e,X,{frequency:c,depth:l}),W.connect(Z.parameters.get("pulsewidth")));let M=ge(a,()=>{Ze(Z),Ze(W),p.disconnect(),n(),h==null||h.stop(),y==null||y.stop()},e,X);return{node:p,stop:G=>{M.stop(G)}}},{prebake:!0,type:"synth"}),[...Fn].forEach(e=>{q(e,(t,n,a)=>{const[c,l,s,o]=B([n.attack,n.decay,n.sustain,n.release],"linear",[.001,.05,.6,.01]);let d,{density:r}=n;d=St(e,t,r);let{node:i,stop:b,triggerRelease:u}=d;const m=C(.3),{duration:X}=n;i.onended=()=>{i.disconnect(),m.disconnect(),a()};const Z=C(1);let y=i.connect(m).connect(Z);const h=t+X;Q(y.gain,c,l,s,o,0,1,t,h,"linear");const p=h+o+.01;return u==null||u(p),b(p),{node:y,stop:W=>{b(W)}}},{type:"synth",prebake:!0})})}function Yn(e,t){const n=new Float32Array(e+1),a=new Float32Array(e+1),c=V(),l=c.createOscillator(),s={sawtooth:r=>[0,-1/r],square:r=>[0,r%2===0?0:1/r],triangle:r=>[r%2===0?0:1/(r*r),0]};if(!s[t])throw new Error(`unknown wave type ${t}`);n[0]=0,a[0]=0;let o=1;for(;o<=e;){const[r,i]=s[t](o);n[o]=r,a[o]=i,o++}const d=c.createPeriodicWave(n,a);return l.setPeriodicWave(d),l}function wn(e,t,n){let{n:a,duration:c,noise:l=0}=n,s;!a||e==="sine"?(s=V().createOscillator(),s.type=e||"triangle"):s=Yn(a,e),s.frequency.value=Xe(n),s.start(t);let o=ye(s.detune,n,t);pe(s.detune,n,t,t+c);const d=Ye(s.frequency,n,t);let r;return l&&(r=Tn(s,l,t)),{node:(r==null?void 0:r.node)||s,stop:i=>{d.stop(i),o==null||o.stop(i),r==null||r.stop(i),s.stop(i)},triggerRelease:i=>{}}}function Jn(e=1,t=.05,n=220,a=0,c=0,l=.1,s=0,o=1,d=0,r=0,i=0,b=0,u=0,m=0,X=0,Z=0,y=0,h=1,p=0,W=0){let M=Math.PI*2,G=V().sampleRate,R=de=>de>0?1:-1,H=d*=500*M/G/G,g=n*=(1+t*2*Math.random()-t)*M/G,N=[],K=0,U=0,x=0,T=1,Ve=0,We=0,J=0,ne,O;for(a=a*G+9,p*=G,c*=G,l*=G,y*=G,r*=500*M/G**3,X*=M/G,i*=M/G,b*=G,u=u*G|0,O=a+p+c+l+y|0;x<O;N[x++]=J)++We%(Z*100|0)||(J=s?s>1?s>2?s>3?Math.sin((K%M)**3):Math.max(Math.min(Math.tan(K),1),-1):1-(2*K/M%2+2)%2:1-4*Math.abs(Math.round(K/M)-K/M):Math.sin(K),J=(u?1-W+W*Math.sin(M*x/u):1)*R(J)*Math.abs(J)**o*e*1*(x<a?x/a:x<a+p?1-(x-a)/p*(1-h):x<a+p+c?h:x<O-y?(O-x-y)/l*h:0),J=y?J/2+(y>x?0:(x<O-y?1:(O-x)/y)*N[x-y|0]/2):J),ne=(n+=d+=r)*Math.cos(X*U++),K+=ne-ne*m*(1-(Math.sin(x)+1)*1e9%2),T&&++T>b&&(n+=i,g+=i,T=0),u&&!(++Ve%u)&&(n=g,d=H,T||(T=1));return N}const vn=(e,t)=>{let{s:n,note:a=36,freq:c,zrand:l=0,attack:s=0,decay:o=0,sustain:d=.8,release:r=.1,curve:i=1,slide:b=0,deltaSlide:u=0,pitchJump:m=0,pitchJumpTime:X=0,lfo:Z=0,znoise:y=0,zmod:h=0,zcrush:p=0,zdelay:W=0,tremolo:M=0,duration:G=.2,zzfx:R}=e;const H=Math.max(G-s-o,0);typeof a=="string"&&(a=Ge(a)),!c&&typeof a=="number"&&(c=yt(a)),n=n.replace("z_","");const g=["sine","triangle","sawtooth","tan","noise"].indexOf(n)||0;i=n==="square"?0:i;const N=Jn(...R||[.25,l,c,s,H,r,g,i,b,u,m,X,Z,y,h,p,W,d,o,M]),K=V(),U=K.createBuffer(1,N.length,K.sampleRate);U.getChannelData(0).set(N);const x=V().createBufferSource();return x.buffer=U,x.start(t),{node:x}};function na(){["zzfx","z_sine","z_sawtooth","z_triangle","z_square","z_tan","z_noise"].forEach(e=>{q(e,(t,n,a)=>{const{node:c}=vn({s:e,...n},t);return c.onended=()=>{c.disconnect(),a()},{node:c,stop:()=>{}}},{type:"synth",prebake:!0})})}let F;async function In(e,t){const n=`dsp-worklet-${Date.now()}`,a=`${t}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${n}', MyProcessor);
`,c=`data:text/javascript;base64,${btoa(a)}`;await e.audioWorklet.addModule(c);const l=new AudioWorkletNode(e,n);return{node:l,stop:()=>l.port.postMessage("stop")}}const Ht=()=>{var e;F&&(F==null||F.stop(),(e=F==null?void 0:F.node)==null||e.disconnect())};typeof window<"u"&&window.addEventListener("message",e=>{var t;e.data==="strudel-stop"?Ht():(t=e.data)!=null&&t.dough&&(F==null||F.node.port.postMessage(e.data))});const aa=async e=>{const t=V();Ht(),F=await In(t,e),F.node.connect(t.destination)};function ca(e,t,n,a,c){window.postMessage({time:c,dough:t.value,currentTime:n,duration:t.duration,cps:a})}export{Mt as DEFAULT_MAX_POLYPHONY,jn as aliasBank,k as analysers,te as analysersData,Ye as applyFM,_ as applyGainCurve,Ce as connectToDestination,Le as createFilter,aa as dough,ca as doughTrigger,nn as drywet,In as dspWorklet,C as gainNode,B as getADSRValues,Kn as getAnalyserById,$n as getAnalyzerData,V as getAudioContext,Dn as getAudioContextCurrentTime,Gn as getAudioDevices,Pn as getCachedBuffer,tn as getCompressor,L as getDefaultValue,Kt as getLfo,Cn as getLoadedBuffer,wn as getOscillator,Q as getParamADSR,pe as getPitchEnvelope,dn as getSampleBuffer,rn as getSampleBufferSource,on as getSampleInfo,Se as getSound,ye as getVibratoOscillator,P as getWorklet,vn as getZZFX,Mn as initAudio,An as initAudioOnFirstClick,xn as initializeAudioOutput,Gt as loadBuffer,w as logger,Xn as onTriggerSample,qn as panic,bn as processSampleMap,Qn as registerSamplesPrefix,q as registerSound,ta as registerSynthSounds,na as registerZZFXSounds,Vn as resetDefaultValues,_n as resetGlobalEffects,En as resetLoadedSounds,un as reverseBuffer,Zn as samples,Wn as setDefaultAudioContext,gt as setDefaultValue,Un as setDefaultValues,Bn as setGainCurve,kn as setLogger,pn as setMaxPolyphony,yn as setMultiChannelOrbits,On as setVersionDefaults,oe as soundMap,Sn as superdough,ea as superdoughTrigger,Yn as waveformN,ge as webAudioTimeout};
